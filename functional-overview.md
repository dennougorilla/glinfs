# fglips 機能概要 - Flutter版の完全継承

**作成日**: 2025-10-31  
**目的**: Flutter版の機能と画面構成を抽象的に記述し、Svelte版で完全に再現する  
**対象読者**: デザイナー、PM、開発者

---

## 目次

1. [アプリケーション概要](#1-アプリケーション概要)
2. [コア機能](#2-コア機能)
3. [画面構成（3画面）](#3-画面構成3画面)
4. [ユーザーフロー](#4-ユーザーフロー)
5. [UI/UXの特徴](#5-uiuxの特徴)
6. [技術的制約](#6-技術的制約)

---

## 1. アプリケーション概要

### 1.1 コンセプト

**「録画ボタンを押し忘れても大丈夫」**

- 常時バッファリング方式の画面録画ツール
- 重要な瞬間を遡ってクリップ化
- 編集してGIFアニメーションとしてエクスポート

### 1.2 ターゲットユーザー

- チュートリアル作成者
- バグレポート作成者
- デザイナー（UIアニメーション記録）
- 開発者（デモGIF作成）

### 1.3 主要な価値提案

1. **遡及的録画**: 過去10秒分を常にバッファに保持
2. **簡単編集**: 直感的なクロップとフレーム選択
3. **高品質GIF**: 複数のエンコーダーから選択可能
4. **軽量**: ブラウザだけで完結、インストール不要

---

## 2. コア機能

### 2.1 画面キャプチャ機能

**説明**:
- ユーザーの画面をリアルタイムで録画
- 循環バッファ方式で最大10秒分（または設定したフレーム数）を保持
- 古いフレームは自動的に削除され、新しいフレームで上書き

**主要な設定**:
- フレームレート: 15/30/60 FPS
- バッファサイズ: 100〜1000フレーム
- サムネイル品質: 10〜100%

**制約**:
- HTTPS環境必須
- ユーザーの明示的な許可が必要
- 録画中は常にメモリを消費

---

### 2.2 クリップ編集機能

**説明**:
- キャプチャしたフレーム群から必要な部分を選択
- フレーム範囲の調整（開始/終了フレーム）
- クロップ（画面の一部を切り取り）
- プレビュー再生

**主要な操作**:
- **フレーム選択**: タイムライン上のハンドルをドラッグ
- **クロップ**: キャンバス上でドラッグして範囲指定
- **プレビュー**: 選択範囲を実際に再生して確認

**補助機能**:
- グリッド表示（構図確認用）
- アスペクト比固定（1:1, 16:9など）
- キーボードショートカット

---

### 2.3 GIFエクスポート機能

**説明**:
- 編集したクリップをGIFファイルに変換
- エンコーダー、品質、速度などを細かく調整可能
- プログレス表示でエンコード状況を確認

**主要な設定**:
- **エンコーダー**: 複数から選択（速度/品質トレードオフ）
- **品質**: 10〜100%（ファイルサイズに影響）
- **フレームスキップ**: 1〜5x（ファイルサイズ削減）
- **再生速度**: 0.25〜2.0x（スロー/早送り）
- **ディザリング**: ON/OFF（グラデーション品質）
- **ループ**: 無限または指定回数

**出力**:
- GIFファイルをダウンロード
- または新しいタブで開く

---

## 3. 画面構成（3画面）

### 3.1 画面1: キャプチャ画面（メイン画面）

**役割**: 画面録画とバッファ管理

**レイアウト**:
```
┌─────────────────────────────────────────────┐
│ [ヘッダー]                                  │
│ fglips (BETA)                     [ヘルプ]  │
├────────────────────────────┬────────────────┤
│                            │                │
│   録画プレビュー領域        │ コントロール   │
│   (画面の映像が表示)        │   パネル       │
│                            │                │
│   ● RECORDING              │ ● 録画状態     │
│   (パルスアニメーション)    │ ● クリップ作成 │
│                            │ ● 品質設定     │
│                            │ ● 使い方       │
│                            │ ● メモリ表示   │
└────────────────────────────┴────────────────┘
       [サポートリンク] [クレジット]
```

**主要なUI要素**:

1. **ヘッダー**
   - アプリ名「fglips」+ BETAバッジ
   - ヘルプボタン

2. **録画プレビュー領域（左側、広い）**
   - リアルタイムの画面映像
   - 録画中インジケーター（赤い点が点滅）
   - 暗めの背景

3. **コントロールパネル（右側、固定幅320px）**
   - **録画状態カード**:
     - 状態テキスト: "Always Recording" / "Waiting..."
     - フレーム数: 150 / 500
     - 時間: 5.0s / 16.7s
     - プログレスバー
   
   - **クリップ作成ボタン**:
     - オレンジ色の大きなボタン
     - アイコン + "Create Clip" テキスト
     - フレームがない時は無効
   
   - **サムネイル品質カード**:
     - スライダー（10〜100%）
     - 現在の品質表示
     - 推定生成時間
   
   - **使い方カード**:
     - ワークフローの説明
     - 箇条書き形式
   
   - **メモリ使用量**:
     - アイコン + MB表示

4. **オーバーレイ（画面下部）**
   - サポートリンク: "Help keep fglips free"
   - クレジット: "Created by dennougorilla"

---

### 3.2 画面2: エディタ画面

**役割**: フレーム選択とクロップ編集

**レイアウト**:
```
┌──────────────────────────────────────────────┐
│ [ヘッダー]                                   │
│ Clip Editor (150/300) [比率][Grid][×][?]    │
├──────────────────────────────────────────────┤
│                                              │
│         ┌─────────────────┐  [クロップ情報] │
│  [再生] │                 │  Position: 10%  │
│  [制御] │  キャンバス     │  Size: 800x450  │
│         │  (フレーム表示) │  Aspect: 16:9   │
│         └─────────────────┘                 │
│                                              │
│                         [エクスポートボタン] │
├──────────────────────────────────────────────┤
│ [タイムライン]                               │
│ ├──START──────────────────END──┤             │
│ [サムネイル帯] [範囲選択ハンドル]            │
│ FRAMES: 150  DURATION: 5.0s  TOTAL: 300     │
└──────────────────────────────────────────────┘
```

**主要なUI要素**:

1. **ヘッダー**
   - タイトル: "Clip Editor"
   - フレームカウンター: "150 / 300"
   - **アスペクト比ドロップダウン**: Free / 1:1 / 16:9 / 4:3 / 9:16
   - **グリッドトグル**: グリッド表示ON/OFF
   - **クロップクリア**: クロップを削除（クロップ中のみ表示）
   - **ヘルプボタン**: キーボードショートカット表示

2. **キャンバスエリア（中央、広い）**
   - グラデーション背景
   - フレーム表示キャンバス
   - クロップオーバーレイ（8つのリサイズハンドル）
   - グリッドパターン（オプション）

3. **再生コントロール（左下オーバーレイ）**
   - 前のフレームボタン
   - 再生/一時停止ボタン（中央、大きめ）
   - 次のフレームボタン
   - 半透明の暗い背景

4. **クロップ情報パネル（右上オーバーレイ）**
   - クロップアイコン + "Crop Area"
   - Position: X%, Y%
   - Size: Wpx x Hpx
   - Aspect Ratio: 数値
   - 実際のサイズ: ピクセル表示

5. **エクスポートボタン（右下FAB）**
   - ダウンロードアイコン
   - "Export (N frames)" テキスト
   - 青色の大きなボタン
   - フレームが選択されていない時は無効

6. **タイムライン（下部、固定高さ240px）**
   - **ステータスバー**:
     - モード表示
     - START/ENDフレーム番号
     - メトリクス: FRAMES / DURATION / TOTAL
   
   - **フレームバー**:
     - サムネイル縦並び
     - 範囲選択ハンドル（ドラッグ可能）
   
   - **コマンドバー**（将来的に追加予定）

---

### 3.3 画面3: エクスポートダイアログ（モーダル）

**役割**: GIF設定とエンコード実行

**レイアウト**:
```
┌─────────────────────────────────┐
│ Export GIF Settings       [×]   │
├─────────────────────────────────┤
│                                 │
│ [エンコーダー選択（グリッド）]  │
│ ┌───────┐ ┌───────┐ ┌───────┐  │
│ │Fast   │ │Medium │ │Slow   │  │
│ │High   │ │Medium │ │Low    │  │
│ │✓ MIT  │ │ MIT   │ │ GPL   │  │
│ └───────┘ └───────┘ └───────┘  │
│                                 │
│ Quality: [━━━━━━━○━━] 80%      │
│ Highest quality                 │
│                                 │
│ Frame Skip: [━━━○━━━━━] 1x      │
│ Use all frames                  │
│                                 │
│ Playback Speed: [━━━━○━━━━] 1.0x│
│ Normal speed                    │
│                                 │
│ [✓] Dithering (improves colors) │
│                                 │
│ Loop: [0] (infinite)  [-] [+]   │
│                                 │
│ [✓] Open in new tab             │
│                                 │
│ Estimated size: ~2.5 MB         │
│                                 │
├─────────────────────────────────┤
│           [Cancel] [Export]     │
└─────────────────────────────────┘
```

**主要なUI要素**:

1. **エンコーダー選択グリッド**
   - カード形式のレイアウト
   - 各エンコーダーカード:
     - 名前
     - 速度ティア（Fast/Medium/Slow）バッジ
     - 品質ティア（High/Medium/Low）バッジ
     - ライセンス（MIT/GPL）バッジ
     - 選択状態: 青枠 + チェックマーク
     - 利用不可: グレーアウト + 理由表示

2. **品質スライダー**
   - 10〜100%（9段階）
   - 説明テキスト: "Fastest" / "Balanced" / "Highest"

3. **フレームスキップスライダー**
   - 1x〜5x
   - 説明テキスト: "Use all frames" / "50% reduction" など

4. **再生速度スライダー**
   - 0.25x〜2.0x
   - 説明テキスト: "Slow-motion" / "Normal" / "Fast-motion"

5. **オプション**
   - **ディザリング**: チェックボックス（説明付き）
   - **ループ回数**: 数値入力 + -/+ ボタン
   - **新しいタブで開く**: チェックボックス

6. **推定ファイルサイズ**
   - リアルタイム計算
   - MB表示

7. **アクションボタン**
   - キャンセル: ダイアログを閉じる
   - エクスポート: エンコード開始

---

### 3.4 サブダイアログ

#### 3.4.1 サムネイル生成ダイアログ

**表示タイミング**: クリップ作成時

**内容**:
- タイトル: "Preparing Editor..."
- プログレスバー（0〜100%）
- 現在のフレーム数 / 総フレーム数
- 進捗メッセージ

**動作**:
- Web Workerでサムネイル生成
- 完了後、自動的にエディタ画面に遷移

---

#### 3.4.2 エンコード進捗ダイアログ

**表示タイミング**: エクスポート実行中

**内容**:
- タイトル: "Encoding GIF..."
- プログレスバー
- パーセント表示
- 現在のフレーム / 総フレーム
- 経過時間
- 推定残り時間
- ステータスメッセージ

**完了時の動作**:
- GIFファイルをダウンロード
- または新しいタブで開く（設定による）

---

#### 3.4.3 ヘルプダイアログ

**表示タイミング**: ヘルプボタンクリック時

**内容**:
- **About fglips**セクション:
  - アプリの説明
  - 主要機能リスト（チェックマーク付き）

- **Keyboard Shortcuts**セクション（エディタ画面）:
  - Space: 再生/一時停止
  - ←/→: 前/次のフレーム
  - Home/End: 最初/最後のフレーム
  - G: グリッド表示切り替え
  - Delete: クロップクリア
  - Ctrl+E: エクスポート

---

## 4. ユーザーフロー

### 4.1 基本フロー（初回ユーザー）

```
1. アプリにアクセス
   ↓
2. 「Start Screen Sharing」ボタンをクリック
   ↓
3. ブラウザの画面選択ダイアログ
   - 画面全体
   - ウィンドウ
   - タブ
   を選択
   ↓
4. 録画開始（自動バッファリング）
   - 録画インジケーター表示（パルス）
   - バッファ情報リアルタイム更新
   ↓
5. 必要な操作を実行（デモ、バグ再現など）
   ↓
6. 「Create Clip」ボタンをクリック
   ↓
7. サムネイル生成（進捗表示）
   ↓
8. エディタ画面に遷移
   ↓
9. フレーム範囲を選択
   - タイムラインのハンドルをドラッグ
   ↓
10. （オプション）クロップエリアを設定
    - キャンバス上でドラッグ
    - リサイズハンドルで調整
    ↓
11. （オプション）プレビュー再生で確認
    ↓
12. 「Export」ボタンをクリック
    ↓
13. エクスポートダイアログで設定
    - エンコーダー選択
    - 品質調整
    - オプション設定
    ↓
14. 「Export」をクリック
    ↓
15. エンコード処理（進捗表示）
    ↓
16. GIFファイル取得
    - ダウンロード
    - または新しいタブで開く
    ↓
17. 完了
```

### 4.2 上級ユーザーフロー

#### シナリオ1: 複数クリップ連続作成

```
録画開始
  ↓
アクション1を実行
  ↓
Clip → 編集 → Export
  ↓
ブラウザバックでキャプチャ画面に戻る
  ↓
アクション2を実行
  ↓
Clip → 編集 → Export
  ↓
繰り返し
```

#### シナリオ2: 高品質GIF作成

```
基本フロー（1〜12）
  ↓
エクスポート設定:
  - エンコーダー: 高速（WASM）
  - 品質: 100%
  - フレームスキップ: 1x（全フレーム）
  - ディザリング: ON
  ↓
推定サイズ: 15 MB
  ↓
エクスポート（約10秒）
  ↓
高品質GIF取得
```

#### シナリオ3: 軽量GIF作成（SNS投稿向け）

```
基本フロー（1〜12）
  ↓
エクスポート設定:
  - エンコーダー: 中速（JS）
  - 品質: 60%
  - フレームスキップ: 2x（50%削減）
  - 再生速度: 1.5x（早送り）
  - ディザリング: OFF
  ↓
推定サイズ: 1.2 MB
  ↓
エクスポート（約20秒）
  ↓
軽量GIF取得 → Twitter/Discord投稿
```

---

## 5. UI/UXの特徴

### 5.1 デザインの特徴

**ダークテーマ**:
- 理由: 画面録画ツールとして目に優しい
- 主背景: 非常に暗い灰色（#121212）
- カード背景: やや明るい灰色（#2C2C2C）
- テキスト: 白/明るい灰色

**カードベースUI**:
- すべての機能がカード型コンポーネント
- 明確な境界線と影
- 視覚的な階層構造

**カラースキーム**:
- **青（#2196F3）**: アクション、選択（プライマリ）
- **オレンジ（#FF9800）**: 作成、エクスポート（セカンダリ）
- **緑（#4CAF50）**: 録画中、成功
- **赤（#F44336）**: エラー、警告

**アニメーション**:
- 録画インジケーター: パルスアニメーション（スケール変化）
- ボタンホバー: わずかに持ち上がる（transform: translateY）
- ページ遷移: フェード + スライド
- プログレスバー: スムーズな幅変化

---

### 5.2 ユーザビリティの特徴

**直感性**:
- アイコン + テキストの組み合わせ
- 明確な視覚的フィードバック
- 状態に応じたボタンの有効/無効

**柔軟性**:
- 設定可能な品質、フレームレート
- 複数のエンコーダーから選択
- カスタマイズ可能なクロップ

**フィードバック**:
- リアルタイムなバッファ統計
- プログレス表示（パーセント + 時間）
- 推定ファイルサイズの事前表示

**エラーハンドリング**:
- 明確なエラーメッセージ
- 解決策の提示
- フォールバック機能（エンコーダーが失敗した場合など）

---

### 5.3 パフォーマンスに関する配慮

**メモリ管理**:
- 循環バッファで古いフレーム自動削除
- フレームキャッシュの制限（現在フレーム ± 3フレーム）
- メモリ使用量の可視化

**UI応答性**:
- 重い処理はWeb Workerで実行（サムネイル生成、エンコード）
- UIスレッドは常に60 FPS維持
- プログレス表示で待ち時間を体感させない

**段階的ロード**:
- 初期ロード時は最小限のJSのみ
- エンコーダー関連は遅延ロード
- WASMモジュールはオンデマンド

---

## 6. 技術的制約

### 6.1 ブラウザ要件

**必須API**:
- Screen Capture API（`getDisplayMedia`）
- Canvas API（2D Context）
- Web Workers API
- WebAssembly API（高速エンコーダー使用時）

**対応ブラウザ**:
- Chrome 94+（推奨）
- Firefox 96+
- Safari 15.4+
- Edge 94+

**非対応**:
- モバイルブラウザ（Screen Capture API未対応）
- 古いブラウザ

---

### 6.2 セキュリティ要件

**HTTPS必須**:
- Screen Capture APIがHTTPSコンテキストでのみ動作
- 開発環境でもHTTPS設定が必要（mkcert等）

**ユーザー許可**:
- 画面共有の開始には明示的なユーザーアクション（クリック）が必要
- 自動起動は不可

**プライバシー**:
- すべての処理はクライアント側で完結
- サーバーへのデータ送信なし
- セッション終了時にバッファクリア

---

### 6.3 パフォーマンス制約

**メモリ制限**:
- ブラウザのメモリ上限: 約2GB
- アイドル時目標: < 50MB
- 録画中目標: < 500MB（300フレーム時）
- ピーク時許容: < 1.5GB

**処理速度**:
- UI応答性: 60 FPS維持必須
- クリップ作成: < 10秒（300フレーム）
- GIFエンコード:
  - 高速（WASM）: 5〜12秒
  - 中速（JS）: 15〜25秒

**ファイルサイズ**:
- 推奨GIFサイズ: < 10MB（SNS投稿可能）
- 警告表示: > 20MB
- 最大想定: 50MB（超高品質）

---

## 7. 将来的な拡張（現在はスコープ外）

### 優先度1（次バージョン）
- MP4/WebMエクスポート
- テキストオーバーレイ
- フレーム補間（AI）

### 優先度2（中期）
- 音声録音対応
- 複数クリップの結合
- プリセット機能（設定保存）

### 優先度3（長期）
- GPU加速エンコード
- クラウド保存
- チーム共有機能

---

## 8. まとめ

### fglipsの本質

**3つの画面で完結するシンプルな構造**:
1. キャプチャ: 常時録画 + バッファ管理
2. エディタ: フレーム選択 + クロップ
3. エクスポート: 設定 + エンコード

**ユーザー体験の核心**:
- 「録画し忘れても大丈夫」という安心感
- 直感的な編集UI
- 高品質なGIF出力

**技術的な要点**:
- ブラウザだけで完結
- メモリ効率的な循環バッファ
- Web Workersによる並列処理
- 複数エンコーダーの選択肢

---

**文書バージョン**: 1.0  
**最終更新**: 2025-10-31  
**次のステップ**: この機能概要を基にSvelte版を実装
